"""
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–≥—Ä—ã "–ú–æ–Ω–æ–ø–æ–ª–∏—è"
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏—è PROMPT5.md

–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ–º—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
1. –ü–æ–ª–Ω—ã–π —Ö–æ–¥ –∏–≥—Ä–æ–∫–∞ (–±—Ä–æ—Å–æ–∫ –∫—É–±–∏–∫–æ–≤, –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ, —ç—Ñ—Ñ–µ–∫—Ç—ã –∫–ª–µ—Ç–∫–∏)
2. –ü–æ–∫—É–ø–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
3. –û–ø–ª–∞—Ç–∞ –∞—Ä–µ–Ω–¥—ã
4. –ü–∞—Ç—Ç–µ—Ä–Ω Strategy: AI —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
5. –ü–∞—Ç—Ç–µ—Ä–Ω Observer: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
"""

import io
import sys

# Fix Windows console encoding issue
if sys.platform == "win32":
    sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding="utf-8")
    sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding="utf-8")

from ai_strategy import (
    AggressiveAIStrategy,
    AIPlayer,
    BalancedAIStrategy,
    ConservativeAIStrategy,
)
from game import GameSession
from observers import ConsoleLoggerObserver, GameEventPublisher, StatisticsObserver


def main():
    """
    –ì–ª–∞–≤–Ω—ã–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
    """

    print("=" * 70)
    print(" " * 20 + "üé≤ –ú–û–ù–û–ü–û–õ–ò–Ø üé≤")
    print("=" * 70)
    print("\n–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ Strategy –∏ Observer")
    print("\n" + "=" * 70 + "\n")

    # === –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ ===
    game = GameSession()

    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã: 3 –∏–≥—Ä–æ–∫–∞ (1 —á–µ–ª–æ–≤–µ–∫ + 2 AI)
    game_config = {
        "players": [
            {"id": "p1", "name": "–ê–ª–∏—Å–∞", "is_ai": False},
            {"id": "p2", "name": "–ë–æ—Ç–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π", "is_ai": True},
            {"id": "p3", "name": "–ë–æ—Ç–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π", "is_ai": True},
        ],
        "settings": {"starting_balance": 1500},
    }

    game.start(game_config)

    # === –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Observer ===
    print("\n" + "=" * 70)
    print("–î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ü–ê–¢–¢–ï–†–ù–ê OBSERVER")
    print("=" * 70)
    print("\n–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π –∫ –∏–≥—Ä–æ–≤—ã–º —Å–æ–±—ã—Ç–∏—è–º...")
    print("- ConsoleLoggerObserver: –≤—ã–≤–æ–¥–∏—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –≤ –∫–æ–Ω—Å–æ–ª—å")
    print("- StatisticsObserver: —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏–≥—Ä—ã\n")

    event_publisher = GameEventPublisher()
    console_logger = ConsoleLoggerObserver()
    statistics = StatisticsObserver()

    event_publisher.attach(console_logger)
    event_publisher.attach(statistics)

    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π —Å –±–∞–Ω–∫–æ–º
    game.bank.event_publisher = event_publisher

    # === –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Strategy ===
    print("\n" + "=" * 70)
    print("–î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ü–ê–¢–¢–ï–†–ù–ê STRATEGY")
    print("=" * 70)
    print("\n–°–æ–∑–¥–∞–Ω–∏–µ AI-–∏–≥—Ä–æ–∫–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏:")
    print("- –ë–æ—Ç–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π: –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ä–∏—Å–∫–∏, —ç–∫–æ–Ω–æ–º–∏—Ç –¥–µ–Ω—å–≥–∏")
    print("- –ë–æ—Ç–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π: –º–∞–∫—Å–∏–º–∏–∑–∏—Ä—É–µ—Ç –≤–ª–∞–¥–µ–Ω–∏—è, –∞–∫—Ç–∏–≤–Ω–æ —Å—Ç—Ä–æ–∏—Ç\n")

    # –°–æ–∑–¥–∞–Ω–∏–µ AI-–∏–≥—Ä–æ–∫–æ–≤
    conservative_ai = AIPlayer(
        game.players[1],  # –ë–æ—Ç–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π
        ConservativeAIStrategy(),
    )

    aggressive_ai = AIPlayer(
        game.players[2],  # –ë–æ—Ç–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π
        AggressiveAIStrategy(),
    )

    ai_players = {"p2": conservative_ai, "p3": aggressive_ai}

    print("‚úì AI-–∏–≥—Ä–æ–∫–∏ —Å–æ–∑–¥–∞–Ω—ã —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏\n")

    # === –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª: 5 —Ä–∞—É–Ω–¥–æ–≤ ===
    print("\n" + "=" * 70)
    print("–ù–ê–ß–ê–õ–û –î–ï–ú–û-–ò–ì–†–´ (5 —Ä–∞—É–Ω–¥–æ–≤)")
    print("=" * 70)

    max_rounds = 5
    for round_num in range(1, max_rounds + 1):
        print(f"\n{'‚ñà' * 70}")
        print(f"{'‚ñà' * 20} –†–ê–£–ù–î {round_num}/{max_rounds} {'‚ñà' * 20}")
        print(f"{'‚ñà' * 70}\n")

        # –ö–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –¥–µ–ª–∞–µ—Ç —Ö–æ–¥
        for _ in range(len(game.players)):
            current_player = game.get_current_player()

            # –î–ª—è AI-–∏–≥—Ä–æ–∫–æ–≤ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
            if current_player.is_ai:
                ai_player = ai_players.get(current_player.id)

                # –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–º–µ–Ω—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–ª–∞–Ω—Å–∞
                if current_player.balance < 500 and isinstance(
                    ai_player.strategy, AggressiveAIStrategy
                ):
                    print(f"\n‚ö†Ô∏è {current_player.name} –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–∏—è—Ö!")
                    ai_player.set_strategy(ConservativeAIStrategy())
                elif current_player.balance > 2000 and isinstance(
                    ai_player.strategy, ConservativeAIStrategy
                ):
                    print(f"\nüí™ {current_player.name} –∏–º–µ–µ—Ç –±–æ–ª—å—à–æ–π —Ä–µ–∑–µ—Ä–≤!")
                    ai_player.set_strategy(AggressiveAIStrategy())

            # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ö–æ–¥–∞
            game.play_turn()

    # === –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–º–µ–Ω—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ ===
    print("\n" + "=" * 70)
    print("–î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –î–ò–ù–ê–ú–ò–ß–ï–°–ö–û–ô –°–ú–ï–ù–´ –°–¢–†–ê–¢–ï–ì–ò–ò")
    print("=" * 70)
    print("\n–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ë–æ—Ç–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –Ω–∞ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é...")
    aggressive_ai.set_strategy(BalancedAIStrategy())

    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    print("\n–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π:")
    for _ in range(len(game.players)):
        game.play_turn()

    # === –í—ã–≤–æ–¥ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ ===
    print("\n" + "=" * 70)
    print("–†–ï–ó–£–õ–¨–¢–ê–¢–´ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–ò")
    print("=" * 70)

    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç Observer
    statistics.print_summary()

    # –ò—Ç–æ–≥–æ–≤—ã–µ –±–∞–ª–∞–Ω—Å—ã
    print("\n" + "=" * 70)
    print("–§–ò–ù–ê–õ–¨–ù–´–ï –ë–ê–õ–ê–ù–°–´ –ò–ì–†–û–ö–û–í:")
    print("=" * 70)
    for player in game.players:
        print(
            f"{player.name}: ${player.balance} | –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏: {len(player.properties)}"
        )

    # === –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ ===
    print("\n" + "=" * 70)
    print("–û–ë–û–°–ù–û–í–ê–ù–ò–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –ü–ê–¢–¢–ï–†–ù–û–í")
    print("=" * 70)

    print("\nüìå –ü–ê–¢–¢–ï–†–ù STRATEGY (–°—Ç—Ä–∞—Ç–µ–≥–∏—è)")
    print("-" * 70)
    print("–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–µ–º–µ–π—Å—Ç–≤–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤, –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –∫–∞–∂–¥–æ–≥–æ")
    print("            –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∏—Ö –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º–æ—Å—Ç–∏")
    print("\n–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ:")
    print("  ‚Ä¢ AIStrategy - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π AI")
    print("  ‚Ä¢ ConservativeAIStrategy - –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å –∏–≥—Ä—ã")
    print("  ‚Ä¢ AggressiveAIStrategy - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å –∏–≥—Ä—ã")
    print("  ‚Ä¢ BalancedAIStrategy - —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å –∏–≥—Ä—ã")
    print("  ‚Ä¢ AIPlayer - –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏")
    print("\n–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:")
    print("  ‚úì AI –º–æ–∂–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏")
    print("  ‚úì –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞")
    print("  ‚úì –ò–∑–æ–ª–∏—Ä—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –æ—Ç –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–∏")
    print("  ‚úì –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ")

    print("\nüìå –ü–ê–¢–¢–ï–†–ù OBSERVER (–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å)")
    print("-" * 70)
    print("–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ '–æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º' –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏")
    print("            –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö")
    print("\n–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ:")
    print("  ‚Ä¢ GameObserver - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è")
    print("  ‚Ä¢ ConsoleLoggerObserver - –≤—ã–≤–æ–¥ —Å–æ–±—ã—Ç–∏–π –≤ –∫–æ–Ω—Å–æ–ª—å")
    print("  ‚Ä¢ StatisticsObserver - —Å–±–æ—Ä –∏–≥—Ä–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏")
    print("  ‚Ä¢ GameEventPublisher - –∏–∑–¥–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏–π")
    print("\n–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:")
    print("  ‚úì –°–ª–∞–±–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –º–µ–∂–¥—É –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π –∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è")
    print("  ‚úì –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–∏ (–∞—É–¥–∏—Ç, –ª–æ–≥–∏, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)")
    print("  ‚úì –ù–∞–±–ª—é–¥–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è/–æ—Ç–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏")
    print("  ‚úì –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –Ω–µ –∑–Ω–∞–µ—Ç –æ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è—Ö - –ø—Ä–∏–Ω—Ü–∏–ø –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç–∏/–∑–∞–∫—Ä—ã—Ç–æ—Å—Ç–∏")

    print("\n" + "=" * 70)
    print("–î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê")
    print("=" * 70)
    print("\n–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ! üé≤\n")


if __name__ == "__main__":
    main()
