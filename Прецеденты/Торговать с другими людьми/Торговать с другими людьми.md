Рамки. Игра «Монополия: Игра человека против машины».

Уровень. Игровой прецедент (взаимодействие между игроками, человеком и машиной).

Основной исполнитель. Игрок (человек).

Заинтересованные лица и их требования.

* **Игрок (человек)** — хочет иметь возможность обмениваться собственностью, деньгами и другими активами с другими игроками (в том числе с машиной), чтобы улучшить своё положение в игре. Хочет, чтобы процесс был понятным, честным и безопасным.
* **Игровой ИИ (машина)** — должен уметь принимать или отклонять торговые предложения, исходя из логики стратегической выгоды (например, анализа рыночной стоимости активов, вероятности выигрыша и текущего баланса).
* **Система (игровое приложение)** — должна обеспечивать корректный обмен активами между сторонами, проверять валидность предложений, сохранять целостность данных и обновлять состояние поля и балансов всех участников.
* **Разработчик** — заинтересован в том, чтобы логика торговых операций была сбалансированной, не допускала злоупотреблений и ошибок (например, невозможности завершить сделку или несогласованности состояния игры).
* **Наблюдатели (другие игроки)** — хотят видеть прозрачность сделки и быть уверенными, что правила торговли соблюдаются одинаково для всех.

Предусловия.

* Игра активна, оба участника (человек и другой игрок/машина) находятся в состоянии «в игре».
* У игрока, инициирующего торговлю, есть активы, которые он может предложить (деньги, собственность, заложенные или свободные клетки, карточки «Шанс»/«Общественная казна»).
* ИИ или другой игрок готовы рассмотреть сделку.

Результаты (постусловия).

* Сделка либо успешно завершена, и активы перераспределены между участниками,
  либо отклонена одной из сторон.
* Балансы и права собственности обновлены в системе.
* В журнал игры внесена запись о состоявшейся или несостоявшейся торговле.
* Игровое поле и интерфейс обновлены, игроки уведомлены о результате.

Основной успешный сценарий (основной процесс).

1. Игрок инициирует торговлю, выбирая в меню действие «Торговать».
2. Система отображает экран выбора партнёра по торговле (другой игрок или машина).
3. Игрок выбирает партнёра.
4. Система открывает интерфейс формирования торгового предложения.
5. Игрок добавляет в предложение активы, которые готов отдать:
   * деньги,
   * собственность (улицы, железные дороги, коммунальные службы),
   * карточки («Шанс», «Общественная казна»),
   * освобождение от аренды или другие особые условия (если разрешены правилами).
6. Игрок указывает, что хочет получить взамен.
7. Система проверяет корректность предложения:
   * не предлагаются ли заложенные объекты без предупреждения,
   * хватает ли у игрока средств,
   * не нарушаются ли правила монополии (например, нельзя продать часть группы, если на ней стоят дома).
8. Система отправляет предложение выбранному партнёру.
9. Партнёр (человек или ИИ) рассматривает предложение.
   * Если это ИИ, система включает алгоритм оценки выгоды сделки на основе текущего состояния игры.
10. Партнёр принимает или отклоняет предложение.
11. Если предложение принято:
    * система выполняет обмен активами,
    * обновляет балансы и права собственности,
    * выводит сообщение об успешной сделке обеим сторонам.
12. Игра сохраняет состояние и возвращается в обычный игровой процесс.

Расширения (альтернативные потоки).

**3а. Партнёр недоступен (например, вышел из игры или потерял соединение).**

1. Система уведомляет игрока, что партнёр не может принять предложение.
2. Торговля отменяется, изменения не применяются.

**5а. Игрок пытается включить в сделку недопустимый актив.**

1. Система сообщает, что актив не может быть передан (например, объект находится под залогом, или на группе построены дома).
2. Игроку предлагается удалить данный актив из предложения.

**6а. Игрок указывает сумму, превышающую его текущий баланс.**

1. Система уведомляет о невозможности провести сделку.
2. Игрок корректирует предложение.

**9а. Партнёр (ИИ) оценивает сделку как невыгодную.**

1. Система отображает сообщение «Предложение отклонено».
2. ИИ может добавить комментарий (например, «Ваша улица слишком дешевая»).
3. Игрок может повторить попытку с другим предложением.

**9б. Партнёр (ИИ) делает встречное предложение.**

1. Система формирует новое предложение на основе анализа.
2. Игроку показывается изменённый вариант (например, с увеличенной суммой или дополнительным активом).
3. Игрок выбирает: принять, отклонить или предложить свою корректировку.

**10а. Игрок передумал и отменяет предложение до ответа партнёра.**

1. Система удаляет сделку из очереди.
2. Обе стороны уведомляются, что торговля отменена.

**11а. Ошибка при передаче активов (например, сбой синхронизации данных).**

1. Система откатывает изменения к состоянию до начала сделки.
2. Выводится сообщение об ошибке, сделка признаётся несостоявшейся.
3. Система записывает сбой в журнал ошибок.

**11б. Сделка приводит к банкротству одного из игроков.**

1. Система проверяет баланс после обмена.
2. Если баланс становится отрицательным, система инициирует процедуру банкротства.
3. Игра перераспределяет активы в соответствии с правилами.

**12а. Сделка влияет на монополию.**

1. Система проверяет, изменилось ли владение группой клеток.
2. Если новый владелец получает полную группу, система уведомляет о появлении монополии.
3. Если группа распадается — убирается статус монополии и автоматически корректируется арендная ставка для всех клеток.

Специальные требования.

* Процесс торговли должен быть интуитивным и пошаговым, с визуальными подсказками.
* Все действия подтверждаются пользователем, прежде чем изменения вступят в силу.
* ИИ должен принимать решения на основе заранее определённых стратегий (например, «играть агрессивно» или «накапливать монополии»).
* Система должна предотвращать нечестные обмены (например, передачу имущества без встречного актива, если игра против ИИ).
* Все торговые операции должны логироваться и быть обратимыми (возможность отката при сбое).
* Интерфейс должен поддерживать обмен сразу несколькими объектами и денежными суммами.
* Сделка должна занимать не более 1 минуты, чтобы не замедлять игровой процесс.

Частота использования: от 1 до 10 раз за партию, чаще в середине игры, когда формируются монополии и идёт активный обмен активами.

Открытые вопросы.

* Должен ли ИИ озвучивать мотивы своих решений (например, «эта сделка улучшает мои шансы»)?
* Может ли игрок предлагать более одного типа бонусов (например, освобождение от аренды и деньги одновременно)?
* Следует ли разрешать обмен заложенными объектами без предварительного выкупа?
* Нужно ли сохранять историю всех торгов между игроками для анализа стратегии?
* Должна ли система ограничивать количество сделок за один ход, чтобы предотвратить злоупотребления?
