# Прецедент: Ход игрока

## Рамки. Игра «Монополия: Игра человека против машины».

## Основной исполнитель. Игрок (человек).

## Заинтересованные лица и их требования.

* **Игрок (человек)** — хочет выполнять ход быстро, понятно и без ошибок. Ожидает, что система корректно обработает бросок кубиков, перемещение по клеткам, начисление бонусов, выполнение обязательных действий (оплата аренды, покупка собственности, получение карт), а также даст возможность добровольных действий (торговля, строительство и т.п.).
* **Игровой ИИ (машина)** — должен корректно реагировать на результаты действий игрока (например, обновление собственностей, изменение состояния клеток), а также корректно вступать в последующие игровые взаимодействия.
* **Система (игровое приложение)** — обязана точно рассчитывать все параметры хода (результат кубиков, новое положение, активные события клетки), следить за правилами игры, обеспечивать устойчивое выполнение всех цепочек действий, уведомлять игрока о возможностях и ограничениях.
* **Разработчик системы** — заинтересован в стабильной работе механики хода, отсутствии логических тупиков (например, невозможности завершить ход), корректной последовательности игровых событий, воспроизводимости результатов.

## Предусловия.

* Игра активна, игрок находится в состоянии «в игре».
* Игрок не в тюрьме, или если он в тюрьме — система позволяет начать ход с ограничениями, предусмотренными правилами.
* Состояние игрового поля и активов остальных участников актуально.

## Результаты.

* Игрок перемещён на соответствующую клетку согласно броску кубиков или правилам выхода из тюрьмы.
* Обработаны все эффекты клетки: аренда, покупка, карточки, налоги, тюрьма, бонусы и т.д.
* Игрок выполнил доступные опциональные действия (если пожелал).
* Ход игрока завершён, и право хода передано следующему участнику.
* Игровое состояние сохранено.

## Основной успешный сценарий.

1. Система сообщает игроку о начале его хода (визуальное или звуковое уведомление).
2. Игрок нажимает кнопку «Бросить кубики».
3. Система случайным образом генерирует значение двух кубиков и отображает результат.
4. Система вычисляет количество шагов и перемещает фишку игрока по полю.
5. Система выделяет клетку, на которой остановился игрок, и определяет её тип:

   * собственность,
   * шанс/общественная казна,
   * налог,
   * тюрьма,
   * «Старт»,
   * бесплатная стоянка,
   * собственность другого игрока,
   * собственность игрока.
6. Система выполняет обязательные игровые события согласно типу клетки:

   * начисление 200 при прохождении «Старт»,
   * оплата аренды,
   * оплата налога,
   * покупка собственности (по желанию игрока),
   * получение карточки,
   * отправка в тюрьму и т.д.
7. Система отображает игроку все обязательные сообщения и последствия хода (например: «Вы должны заплатить аренду 50», «Вы вытянули карту: заплатите 100»).
8. Игрок выполняет все обязательные действия (подтверждает оплату, принимает карту и т.д.).
9. После обязательных действий система предлагает игроку выполнить опциональные действия до завершения хода:

   * торговля,
   * залог/выкуп собственности,
   * строительство домов или отелей (если есть монополия),
   * продажа собственности,
   * использование бонусных карт.
10. Игрок выполняет необходимые дополнительные действия или отказывается от них.
11. Игрок нажимает «Завершить ход».
12. Система фиксирует состояние игрока, завершает ход и передаёт право хода следующему участнику.

## Расширения

**2а. Игрок выбрасывает дубль.**

1. Система определяет выпадение дубля.
2. Игрок совершает полный ход.
3. После завершения обязательных действий система сообщает, что игрок имеет право на дополнительный ход.
4. Игрок выполняет второй ход.
5. Если выпадают три дубля подряд — игрок отправляется в тюрьму.

**3а. Задержка игры.**

1. Система откатывает попытку броска.
2. Игроку отображается сообщение: «Повторите бросок».

**4а. Игрок проходит клетку «Старт».**

1. Система начисляет 200 (или другую сумму, если дом-правила иные).
2. Система отображает сообщение о начислении.

**5а. Игрок попадает на клетку собственной собственности.**

1. Система уведомляет: «Вы попали на свою собственность».
2. Никаких обязательных действий нет, переход к шагу 9.

**6а. Игрок попадает на свободную собственность.**

1. Система предлагает купить клетку.
2. Игрок выбирает купить или отказаться.
3. Если покупает — обновляется баланс и реестр собственности.
4. Если отказывается — может быть начат аукцион (если игра с аукционами).

**6б. Игрок попадает на собственность другого игрока.**

1. Система рассчитывает аренду и запускает прецедент «Платить аренду».
2. После завершения оплаты — продолжение хода.

**6в. Игрок вытягивает карточку «Шанс» или «Общественная казна».**

1. Система отображает карточку и применяет её эффект (движение по полю, штрафы, бонусы).
2. Если карточка перемещает фишку на другую клетку — система повторно запускает соответствующие эффекты клетки.

**6г. Игрок попадает на налоговую клетку.**

1. Система списывает сумму налога.
2. Игрок подтверждает оплату.

**6д. Игрок должен идти в тюрьму.**

1. Система перемещает игрока в тюрьму.
2. Система изменяет состояние игрока (тюремный статус + счётчик ходов в тюрьме).
3. Игроку запрещены стандартные опции.

**7а. Недостаточно средств для обязательного платежа.**

1. Система сообщает о нехватке средств.
2. Система предлагает варианты: заложить имущество, продать собственность, использовать бонусную карту или объявить банкротство.
3. После выполнения одного из вариантов система пытается провести платёж заново.

**9а. Игрок решает совершить торговую операцию.**

1. Запускается прецедент «Торговать с другими игроками».
2. После завершения сделки ход продолжается.

**9б. Игрок пытается построить дом/отель, но у него нет монополии.**

1. Система выводит сообщение: «Невозможно построить дом: нет монополии в группе».
2. Игрок возвращается к списку действий.

**10а. Игрок задерживается в выборе действий слишком долго.**

1. Если игра ограничена по времени — система автоматически завершает ход.

**11а. Игрок нажимает завершение хода, но не выполнены обязательные действия.**

1. Система выводит предупреждение: «Не завершены обязательные действия».
2. Игрок возвращается к шагу 6—8.

## Открытые вопросы.

* Нужно ли автоматически применять некоторые опциональные действия (например, быструю постройку, если у игрока есть монополия)?
* Следует ли отображать подробный анализ последствий хода (например, прогноз аренды на следующих клетках)?
