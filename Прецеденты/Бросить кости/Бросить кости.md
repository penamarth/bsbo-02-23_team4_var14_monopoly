# Прецедент: «Бросить кости»

**Рамки.** Игра «Монополия» — ход игрока/машины, выполнение броска костей и последующее применение результатов броска в игровую логику (перемещение фишки, активация событий поля, обработка дублей и т. п.).

**Уровень.** Задача, определённая пользователем (игрок/ИИ): выполнить бросок костей на своём ходе.

**Основной исполнитель.** Игрок (человек) — когда ходить должен человек;
(в варианте: Автомат — когда ходит компьютер).

---

## Заинтересованные лица и их требования

* **Игрок (человек).** Хочет, чтобы бросок был честным, быстрым и визуально понятным; хочет видеть результат и следующее действие (перемещение), чтобы уверенно принимать дальнейшие решения. Для игрока важно понятное управление (кнопка/жест) и доступность (включая людям с нарушениями зрения/движения).
* **Игровой ИИ (компьютер).** Ожидает выполнения броска в коде без вмешательства, корректной генерации случайных чисел и применения правил (например, обработка дублей).
* **Система правил.** Требует точных данных броска (значения каждой кости) для корректного применения правил (движение, коммунальные карточки, попадание в тюрьму при трёх дублях и т.д.).
* **Разработчик.** Хочет обеспечить честную случайность, логирование бросков, воспроизводимость (при необходимости), и защиту от читинга / манипуляций.

---

## Предусловия

1. Игра запущена и загружена текущая игровая сессия.
2. Имеется валидный ход: сейчас очередь для данного игрока (человека или ИИ).
3. Позиции фишек и состояние игры (наличные, собственность, тюрьма и пр.) актуальны и сохранены в памяти.
4. Если игрок в тюрьме — проверены условия для броска (оплата/карта/попытка выбросить дубль).
5. Интерфейс активен (кнопка «Бросить», клавиши, жесты и т. п.).

---

## Результаты (постусловия)

* Сгенерированы и сохранены значения двух (или заданного числа) костей.
* Значение броска отображено игроку.
* Если бросок корректен — перемещена фишка на сумму выпавших кубиков.
* Правила, зависящие от броска, применены: покупки/аренда/штрафы/карточки и т.д.
* Если выпал дубль — выполнена логика дополнительного хода или правила тюрьмы (третья подряд — отправка в тюрьму).
* Все события, порождённые броском, зафиксированы в логе/истории хода.
* Интерфейс обновлён (позиции фишек, баланс, подсказки).

## Основной успешный сценарий

1. Игрок видит, что наступил его ход (или ход компьютера).
   Интерфейс сообщает об этом, подсвечивая кнопку «Бросить кости».

2. Игрок нажимает кнопку **«Бросить кости»**, чтобы выполнить свой ход.
   (Если сейчас ход компьютера, игрок видит, как компьютер автоматически совершает бросок.)

3. На экране начинается **анимация броска костей**.

4. После завершения анимации игрок **видит результат броска** — значения, выпавшие на обеих костях, и их сумму.
   Интерфейс может показать короткое сообщение: *«Выпало 4 и 5 — всего 9!»*

5. Игрок наблюдает, как **его фишка перемещается по игровому полю** на соответствующее количество клеток.
   Движение сопровождается плавной анимацией, чтобы игрок понимал, куда попадает.

6. После остановки фишки игрок видит, **на каком поле он оказался**, и получает соответствующую информацию:

   * описание клетки (например, название улицы или карточки «Шанс»);
   * доступные действия — купить, заплатить аренду, вытянуть карточку и т.п.

7. Если игрок выбросил **дубль** (два одинаковых числа), он видит уведомление, что ему предоставляется **дополнительный ход**.
   Если это **третий дубль подряд**, игроку сообщается, что он **отправляется в тюрьму**, и фишка перемещается туда автоматически.

8. Если игрок находился в тюрьме и выбросил дубль, интерфейс сообщает об освобождении, и фишка перемещается вперёд на выпавшее количество клеток.

9. После завершения всех действий, связанных с броском, игрок видит **обновлённое состояние игры**:

   * новое положение фишек,
   * изменённые суммы денег,
   * подсказки о возможных действиях.

10. Если у игрока есть дополнительный ход (например, после дубля), интерфейс сообщает: *«Ваш дополнительный ход»*, и игрок снова может нажать «Бросить кости».
    Если хода больше нет — ход переходит к следующему игроку, и интерфейс сообщает об этом.

11. Игрок может видеть краткое сообщение или визуальное подтверждение, что ход завершён, и игра автоматически сохраняет текущее состояние партии.

---

## Расширения / альтернативные потоки

### A. Выпал неправильный/некорректный результат (например, значение вне 1..6)

1. Система детектирует аномалию, не применяет результат и логирует событие как ошибку.
2. Система повторяет бросок с корректной системой случайности либо переводит игру в режим восстановления.

### B. Игрок в тюрьме

* B1. Игрок пытается выбрать опцию «бросить кости», чтобы попытаться выбросить дубль:

  1. Система разрешает бросок.
  2. Если выпал дубль — игрок освобождается и перемещается; иначе — уменьшается количество попыток (или выполняются альтернативные правила).
* B1. Игрок платит штраф вместо броска — соответствующие операции обработки платежа выполняются.

### C. Дубль выпал — дополнительные действия

* C1. Один или два дубля подряд — игрок получает дополнительный ход; счётчик увеличивается.
* C2. Третий подряд дубль — игрок отправляется в тюрьму; фишка перемещается в «тюрьму», счётчик дублей обнуляется.
* C3. Дубль в тюрьме — освобождение и движение.

## Специальные требования

* **Честный бросок костей.** Каждый бросок выполняется случайно и честно — без возможности подделки результата. В соревновательных режимах система может показывать информацию, подтверждающую честность (например, «идентификатор броска» или seed).
* **История бросков.** Все броски автоматически сохраняются в журнал, чтобы при необходимости можно было просмотреть или воспроизвести ход игры.
* **Плавная анимация.** Анимация броска костей длится не дольше нескольких секунд и не тормозит игру. При желании игрок может включить «быстрый режим», где бросок происходит мгновенно.
* **Настраиваемые правила.** В настройках можно включить или выключить особые правила (например, третий дубль отправляет в тюрьму, количество костей и т. п.), чтобы адаптировать игру под домашние варианты.


## Вопросы, решаемые при настройке игры

1. Как именно подтверждается честность броска (например, показ seed или идентификатора)?
2. Нужно ли сохранять подробные данные о каждом броске постоянно или только в соревновательных играх?
3. Можно ли пропустить или ускорить анимацию броска?
4. Можно ли настраивать домашние правила (например, третий дубль = тюрьма)?
5. Какие меры применяются при подозрении на нечестную игру?
