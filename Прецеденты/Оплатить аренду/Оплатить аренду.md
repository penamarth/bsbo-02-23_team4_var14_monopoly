Рамки. Игра «Монополия: Игра человека против машины».

Уровень. Игровой прецедент (взаимодействие игрока и системы).

Основной исполнитель. Игрок (человек).

Заинтересованные лица и их требования.

* **Игрок (человек)** — хочет, чтобы игра корректно рассчитала сумму аренды,
учитывая все игровые правила (наличие домов, отелей, монополий, залогов).
Хочет понимать, за что именно он платит, видеть расчёт и подтверждение перевода
средств. Требует справедливого поведения системы и отсутствия ошибок.
* **Игровой ИИ (машина)** — должен получать оплату аренды за принадлежащие ему
клетки строго по правилам игры. Хочет, чтобы система корректно применяла все
бонусы и исключения.
* **Система (игровое приложение)** — должна автоматически определять владельца
клетки, рассчитывать сумму аренды, инициировать и завершать транзакцию между
участниками, обновлять балансы и выводить пользователю соответствующие
уведомления.
* **Разработчик/дизайнер игры** — заинтересован в устойчивости и
воспроизводимости логики аренды, а также в предотвращении конфликтных ситуаций
(ошибок округления, двойных платежей, зависаний логики).

Предусловия.

* Игровая партия активна.
* Игрок выполнил бросок кубиков и остановился на клетке, принадлежащей
сопернику.
* Собственность корректно зарегистрирована в системе, и данные о владельце
клетки доступны.
* У игрока есть или отсутствуют средства для оплаты аренды — в зависимости от
ситуации сценарий может развиваться по-разному.

Результаты (постусловия).

* Сумма аренды корректно вычислена и зафиксирована.
* Баланс игрока уменьшен на величину аренды.
* Баланс владельца клетки увеличен на ту же сумму.
* Игровое сообщение об оплате аренды отображено обоим участникам.
* Если у игрока недостаточно средств, инициирована процедура ликвидации активов
(продажа, залог, банкротство).
* Все данные о транзакции сохранены в журнале игры для анализа.

Основной успешный сценарий (основной процесс).

1. Игрок совершает ход, бросает кубики и перемещает свою фишку по игровому полю.
2. Система определяет клетку, на которой остановился игрок.
3. Система проверяет принадлежность клетки.
   * Если клетка имеет владельца — сценарий продолжается.
   * Если клетка свободна — активируется сценарий покупки (вне рамок текущего
   прецедента).
5. Система рассчитывает сумму аренды:
   * базовая аренда для данной клетки,
   * корректировка с учётом числа домов и отелей,
   * бонусы монополии (удвоенная аренда, если владелец владеет всей группой),
   * особые правила (например, «железные дороги» или «коммунальные службы»
   рассчитываются по числу объектов или по результату кубиков).
6. Система отображает игроку сообщение с информацией:
   * название клетки,
   * имя владельца,
   * сумма аренды,
   * краткое описание расчёта (например, «2 дома, монополия на цвет — аренда
   удвоена»).
7. Игрок подтверждает оплату (нажимает кнопку «Оплатить аренду»).
8. Система списывает средства с баланса игрока и зачисляет их владельцу.
9. Система обновляет балансы обоих участников на экране.
10. Система отображает уведомление об успешной оплате и передаёт ход следующему
игроку.
11. В журнал партии заносится запись об оплате аренды с указанием всех
параметров.

Расширения (альтернативные потоки).

**2а. Клетка не принадлежит никому.**

1. Система предлагает игроку купить клетку.
2. Если игрок соглашается — запускается сценарий «Покупка собственности».
3. Если игрок отказывается — ход завершается, и право покупки может быть
передано другим игрокам (аукцион).

**3а. Собственность заложена.**

1. Система определяет, что клетка находится под залогом.
2. Система сообщает игроку, что аренда не взымается.
3. Ход игрока завершается без изменения баланса.

**4а. Игроку предоставлена льгота или бонус.**

1. Система определяет наличие активной льготы.
2. Система сообщает игроку, что аренда не требуется.
3. Льгота аннулируется (если одноразовая).

**5а. У игрока недостаточно средств для оплаты аренды.**

1. Система уведомляет игрока: «Недостаточно средств для оплаты аренды».
2. Система предлагает варианты действий:
   * Продать собственность.
   * Заложить имущество.
   * Использовать бонусные средства (если доступны).
   * Объявить банкротство.
3. Игрок выбирает вариант.
   3а. Игрок продаёт собственность — система обновляет баланс, затем повторяет
   расчёт аренды.
   3б. Игрок закладывает имущество — система фиксирует изменение состояния
   клеток и проверяет, хватает ли средств.
   3в. Игрок объявляет банкротство — система передаёт все активы владельцу
   долга, выводит игрока из игры, обновляет список активных участников.

**5б. Игрок теряет соединение или покидает игру в момент оплаты.**

1. Система приостанавливает текущий ход.
2. При восстановлении соединения система предлагает продолжить оплату или
применить автоматическое списание.
3. Если игрок не возвращается — система выполняет автосписание (при достаточном
балансе) или объявляет банкротство.

**6а. Ошибка при обновлении баланса.**

1. Система откатывает транзакцию до состояния до оплаты.
2. Система выводит сообщение об ошибке и предлагает повторить оплату.
3. В журнал записывается ошибка и отметка о времени сбоя.

**7а. Игрок получает бонус после оплаты (например, карточка «Возврат части
аренды»).**

1. После оплаты система проверяет активные бонусы.
2. Если найден бонус, игроку возвращается часть средств.
3. Система обновляет баланс и отображает уведомление.

Специальные требования.

* Расчёт аренды должен быть полностью автоматизирован, без ручного ввода.
* Время отклика при расчёте аренды — не более 2 секунд.
* Интерфейс должен визуально выделять клетки, требующие оплаты аренды.
* Сообщения должны быть понятны игроку (включая объяснение: «Аренда удвоена,
так как владелец владеет всей группой»).
* Игра должна сохранять состояние после каждой аренды, чтобы в случае сбоя
можно было восстановить ход.
* При игре против машины ИИ должен следовать тем же правилам аренды, что и
человек.

Частота использования: несколько раз в каждом игровом раунде, почти при каждом
перемещении по полю.

Открытые вопросы.

* Следует ли показывать детальный расчёт аренды игроку (разбивку по факторам)?
* Нужно ли подтверждение от игрока на каждый платёж или возможно автоматическое
списание?
* Как обрабатывать ситуации, когда оба игрока неактивны (человек и ИИ)?
* Следует ли хранить историю аренды для последующего анализа стратегий?
* Возможно ли автоматическое зачисление аренды при ускоренных режимах игры?
